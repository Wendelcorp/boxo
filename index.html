<!DOCTYPE html>
<html>
<head>
    <title>BOXO</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            color: #3375BB;
            text-align: center;
            background-color: #FEC569;
        }

        #game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }

        #grid {
            display: grid;
            grid-template-columns: repeat(2, 100px);
            grid-template-rows: repeat(2, 100px);
            gap: 0;
            margin: 0 auto;
            margin-bottom: 20px;
        }

        .grid-square {
            width: 100px;
            height: 100px;
            background-color: #C2DFF5;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 36px;
            position: relative;
        }

        .grid-square::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 4px solid #3375BB;
            box-sizing: border-box;
        }

        #tiles-container {
            margin-bottom: 20px;
        }

        .tile {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            margin: 5px;
            border: 3px solid #3375BB;
            background-color: #F7A5AC;
            cursor: grab;
            user-select: none;
            font-size: 42px;
            font-weight: bolder;
            aspect-ratio: 1 / 1;
            width: 88px;
        }

        .tile:active {
            cursor: grabbing;
        }

        #reset-button, #hint-button, #next-level-button {
            margin: 5px;
            padding: 10px 20px;
            font-size: 16px;
        }

        #message {
            margin-top: 20px;
            font-size: 24px;
            font-weight: bold;
        }

        .letter-left {
            position: relative;
            top: -18px;
            left: -6px;
        }

        .letter-right {
            position: relative;
            top: 18px;
            left: 6px;
        }

        @media (max-width: 600px) {
            .grid-square, .tile {
                width: 60px;
                height: 60px;
                font-size: 24px;
            }

            #grid {
                grid-template-columns: repeat(2, 60px);
                grid-template-rows: repeat(2, 60px);
            }

            #tiles-container {
                width: 100%;
                display: flex;
                justify-content: center;
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <h1>BOXO</h1>
    <div id="game-container">
        <div id="level-indicator">Level 1</div>
        <div id="tiles-container"></div>
        <div id="grid"></div>
        <div class="buttons">
            <button id="reset-button">Reset</button>
            <button id="hint-button">Hint</button>
            <button id="next-level-button" disabled>Next Level</button>
        </div>
        <div id="message"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const levels = {
                1: ["List", "Step", "Keep", "Like"],
                2: ["Sore", "Rely", "Only", "Soon"],
                3: ["Note", "Text", "Next", "None"],
                4: ["Wish", "Shed", "Need", "Wine"],
                5: ["Dare", "Rest", "Test", "Date"]
            };

            let currentLevel = 1;
            let tiles = [];
            let targetWords = {};
            let correctPositions = {};
            let draggedTile = null;

            const gridContainer = document.getElementById('grid');
            const tilesContainer = document.getElementById('tiles-container');
            const resetButton = document.getElementById('reset-button');
            const hintButton = document.getElementById('hint-button');
            const nextLevelButton = document.getElementById('next-level-button');
            const messageDiv = document.getElementById('message');
            const levelIndicator = document.getElementById('level-indicator');

            function initLevel(level) {
                // Clear previous tiles and grid
                tilesContainer.innerHTML = '';
                gridContainer.innerHTML = '';
                messageDiv.textContent = '';
                nextLevelButton.disabled = true;
                levelIndicator.textContent = `Level ${level}`;

                // Get words for the level
                const levelWords = levels[level];
                if (!levelWords) {
                    messageDiv.textContent = 'No more levels!';
                    return;
                }

                // Map words to their positions
                targetWords = {
                    leftColumn: levelWords[0].toUpperCase(),
                    bottomRow: levelWords[1].toUpperCase(),
                    rightColumn: levelWords[2].toUpperCase(),
                    topRow: levelWords[3].toUpperCase()
                };

                // Generate tiles and correct positions
                generateTilesAndPositions();

                // Create grid squares
                createGridSquares();

                // Add event listeners to tiles and grid squares
                addEventListeners();

                // Shuffle the tiles after they are added to the container
                shuffleDivs();
            }

            function generateTilesAndPositions() {
                const tileLetters = {};

                const tile00 = [targetWords.topRow[0], targetWords.topRow[1]];
                const tile01 = [targetWords.topRow[2], targetWords.topRow[3]];
                const tile10 = [targetWords.bottomRow[0], targetWords.bottomRow[1]];
                const tile11 = [targetWords.bottomRow[2], targetWords.bottomRow[3]];

                // Store tile letters
                tileLetters['tile00'] = tile00;
                tileLetters['tile01'] = tile01;
                tileLetters['tile10'] = tile10;
                tileLetters['tile11'] = tile11;

                // Create tiles
                tiles = [];
                for (let key in tileLetters) {
                    const letters = tileLetters[key];
                    const tileId = `tile-${letters.join('')}`;
                    const tile = document.createElement('div');
                    tile.classList.add('tile');
                    tile.id = tileId;
                    tile.setAttribute('draggable', 'true');
                    tile.dataset.letters = letters.join(',');

                    const spanLeft = document.createElement('span');
                    spanLeft.classList.add('letter-left');
                    spanLeft.textContent = letters[0];

                    const spanRight = document.createElement('span');
                    spanRight.classList.add('letter-right');
                    spanRight.textContent = letters[1];

                    tile.appendChild(spanLeft);
                    tile.appendChild(spanRight);

                    tilesContainer.appendChild(tile);
                    tiles.push(tile);
                }

                correctPositions = {
                    [`tile-${tile00.join('')}`]: '0-0',
                    [`tile-${tile01.join('')}`]: '0-1',
                    [`tile-${tile10.join('')}`]: '1-0',
                    [`tile-${tile11.join('')}`]: '1-1'
                };
            }

            function createGridSquares() {
                for (let row = 0; row < 2; row++) {
                    for (let col = 0; col < 2; col++) {
                        const square = document.createElement('div');
                        square.classList.add('grid-square');
                        square.dataset.position = `${row}-${col}`;
                        gridContainer.appendChild(square);
                    }
                }
            }

            function addEventListeners() {
                const gridSquares = document.querySelectorAll('.grid-square');

                tiles.forEach(tile => {
                    tile.addEventListener('dragstart', (e) => {
                        draggedTile = tile;
                        e.dataTransfer.setData('text/plain', tile.dataset.letters);
                    });

                    tile.addEventListener('touchstart', (e) => {
                        draggedTile = tile;
                        e.target.style.opacity = '0.5';
                    });

                    tile.addEventListener('touchmove', (e) => {
                        e.preventDefault();
                        const touch = e.touches[0];
                        tile.style.position = 'absolute';
                        tile.style.left = `${touch.pageX - 50}px`;
                        tile.style.top = `${touch.pageY - 50}px`;
                    });

                    tile.addEventListener('touchend', (e) => {
                        tile.style.opacity = '1';
                        tile.style.position = '';
                        checkTouchDrop(e);
                    });
                });

                gridSquares.forEach(square => {
                    square.addEventListener('dragover', (e) => {
                        e.preventDefault();
                    });

                    square.addEventListener('drop', (e) => {
                        e.preventDefault();
                        if (square.children.length === 0 && draggedTile) {
                            square.appendChild(draggedTile);
                            checkCompletion();
                            draggedTile = null;
                        }
                    });

                    square.addEventListener('touchend', (e) => {
                        checkTouchDrop